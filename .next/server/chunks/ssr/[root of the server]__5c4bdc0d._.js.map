{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/default-data.ts"],"sourcesContent":["\n// src/lib/default-data.ts\nimport type { User, Event, Announcement } from './types';\n\nexport const defaultUsers: User[] = [\n    { id: 'Steve', username: 'Steve', avatarUrl: `https://placehold.co/100x100.png?text=St`, op: 0, password: '123456', qqNumber: '123456789', ban: 0 },\n    { id: 'Alex', username: 'Alex', avatarUrl: `https://placehold.co/100x100.png?text=Al`, op: 0, password: '123456', qqNumber: '987654321', ban: 0 },\n    { id: 'Notch', username: 'Notch', avatarUrl: `https://placehold.co/100x100.png?text=No`, op: 1, password: '123456', qqNumber: '10001', ban: 0 },\n    { id: 'dream_pep_id', username: 'dream_pep', avatarUrl: `https://placehold.co/100x100.png?text=dr`, op: 1, password: '123456', qqNumber: '12345', ban: 0 },\n    { id: 'CoAdminUser', username: 'CoAdminUser', avatarUrl: `https://placehold.co/100x100.png?text=CA`, op: 2, password: '123456', qqNumber: '234567890', ban: 0 }\n];\n\nexport const defaultEvents: Event[] = [\n    {\n        id: 'event1', name: '生存游戏锦标赛', date: '2024-07-29T12:00:00.000Z', endDate: '2024-07-29T18:00:00.000Z',\n        timeMode: 'specified', isCheckInEnabled: true,\n        description: \"\\n### 欢迎参加年度生存游戏！\\n证明你的勇气，成为最后的幸存者。\\n**规则：**\\n- 禁止作弊\\n- 联盟是暂时的\\n- 玩得开心！\\n**奖品：**\\n- 第一名：钻石奖杯\\n- 第二名：金锭\\n- 第三名：铁制工具\\n\",\n        participantLimit: 24,\n        participants: [\n             { id: 'Steve', username: 'Steve', avatarUrl: `https://placehold.co/100x100.png?text=St`, isCheckedIn: false, op: 0, password: '123456', qqNumber: '123456789', ban: 0 },\n             { id: 'dream_pep_id', username: 'dream_pep', avatarUrl: `https://placehold.co/100x100.png?text=dr`, isCheckedIn: false, op: 1, password: '123456', qqNumber: '12345', ban: 0 }\n        ],\n        cdKey: 'SURVIVAL2024', imageUrl: `https://placehold.co/800x400.png`, organizerId: 'Notch',\n    },\n    {\n        id: 'event2', name: '创意建筑大赛', date: '2024-07-22T12:00:00.000Z', endDate: '2024-07-25T23:59:00.000Z',\n        timeMode: 'specified', isCheckInEnabled: true,\n        description: \"\\n## 展示你的建筑技巧！\\n主题：**中世纪城堡**\\n在时限内建造最令人印象深刻的城堡。\\n评分标准：\\n- 创意\\n- 细节\\n- 规模\\n\",\n        participantLimit: 50,\n        participants: [\n            { id: 'Steve', username: 'Steve', avatarUrl: `https://placehold.co/100x100.png?text=St`, isCheckedIn: true, op: 0, password: '123456', qqNumber: '123456789', ban: 0 },\n            { id: 'Alex', username: 'Alex', avatarUrl: `https://placehold.co/100x100.png?text=Al`, isCheckedIn: false, op: 0, password: '123456', qqNumber: '987654321', ban: 0 },\n        ],\n        cdKey: 'BUILDMC2024', imageUrl: `https://placehold.co/800x400.png`, organizerId: 'Notch',\n    },\n    {\n        id: 'event3', name: '跑酷挑战赛(长期)', date: '2024-07-01T00:00:00.000Z', endDate: null, // Long-term, no specific end date\n        timeMode: 'long-term', isCheckInEnabled: false,\n        description: '在我们全新的长期跑酷地图中测试你的敏捷性。随时来挑战，没有签到要求！',\n        participants: [ { id: 'dream_pep_id', username: 'dream_pep', avatarUrl: `https://placehold.co/100x100.png?text=dr`, isCheckedIn: false, op: 1, password: '123456', qqNumber: '12345', ban: 0 } ], // isCheckedIn is false for long-term\n        cdKey: 'PARKOURXLT', imageUrl: `https://placehold.co/800x400.png`, organizerId: 'Notch',\n    },\n     {\n        id: 'event4', name: '红石装置展览会', date: '2024-08-21T12:00:00.000Z', endDate: '2024-08-22T12:00:00.000Z',\n        timeMode: 'specified', isCheckInEnabled: false, // Example of specified time but no check-in\n        description: '展示你最巧妙的红石发明。创新是关键！本次活动无需签到。', participantLimit: 10, participants: [],\n        cdKey: 'REDSTONEFAI', imageUrl: `https://placehold.co/800x400.png`, organizerId: 'Notch',\n    },\n    {\n        id: 'event_1747228478227_2n7f2', name: 'BETA测试活动', date: '2025-05-16T21:14:00.000Z', endDate: null,\n        timeMode: 'specified', isCheckInEnabled: true,\n        description: '这是一个BETA阶段的测试活动，用于测试系统的各项功能。欢迎参与并提供反馈！',\n        participantLimit: 50, cdKey: 'Beta1', imageUrl: '',\n        participants: [{id: 'dream_pep_id', username: 'dream_pep', avatarUrl: 'https://placehold.co/100x100.png?text=dr', isCheckedIn: false, op: 1, password: \"123456\", qqNumber: '12345', ban: 0}],\n        organizerId: 'dream_pep_id'\n    }\n];\n\nexport const defaultAnnouncements: Announcement[] = [\n  { id: 'announce1', title: '欢迎来到 VRCub 活动中心!', content: '发现、加入并创建精彩的《我的世界》活动。祝您玩得愉快！', date: new Date().toISOString() },\n  { id: 'announce2', title: '新功能：仪表盘公告', content: '现在您可以在仪表盘查阅最新公告了。', date: new Date(Date.now() - 86400000).toISOString() }, // 1 day ago\n];\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 231, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/db.ts"],"sourcesContent":["\nimport Database from 'better-sqlite3';\nimport path from 'path';\nimport fs from 'fs';\nimport type { Event, User, Participant, Announcement } from './types';\nimport { defaultUsers, defaultEvents, defaultAnnouncements } from './default-data';\n\nconst DATA_DIR = path.join(process.cwd(), 'data');\nconst DB_PATH = path.join(DATA_DIR, 'minevent.sqlite');\n\nif (!fs.existsSync(DATA_DIR)) {\n  fs.mkdirSync(DATA_DIR, { recursive: true });\n}\nconsole.log(`Database path: ${DB_PATH}`);\n\nexport const db = new Database(DB_PATH);\ndb.pragma('journal_mode = WAL');\ndb.pragma('foreign_keys = ON');\n\nfunction tableExists(tableName: string): boolean {\n  const stmt = db.prepare(\"SELECT name FROM sqlite_master WHERE type='table' AND name=?\");\n  return !!stmt.get(tableName);\n}\n\nfunction columnExists(tableName: string, columnName: string): boolean {\n  const stmt = db.prepare(`PRAGMA table_info(${tableName})`);\n  const columns = stmt.all() as { name: string }[];\n  return columns.some(col => col.name === columnName);\n}\n\nfunction initializeDatabase() {\n  console.log('Initializing database schema if needed...');\n\n  // Users Table\n  const usersTableExists = tableExists('users');\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS users (\n      id TEXT PRIMARY KEY,\n      username TEXT NOT NULL UNIQUE,\n      avatarUrl TEXT,\n      op INTEGER DEFAULT 0,\n      password TEXT,\n      qqNumber TEXT UNIQUE,\n      ban INTEGER DEFAULT 0\n    );\n  `);\n  if (usersTableExists) {\n    if (!columnExists('users', 'qqNumber')) {\n      console.log(\"Attempting to add 'qqNumber' column to users table...\");\n      try {\n        db.exec('ALTER TABLE users ADD COLUMN qqNumber TEXT UNIQUE');\n        console.log(\"'qqNumber' column added to users table.\");\n      } catch (e) {\n        console.error(\"Failed to add 'qqNumber' column to users table (it might already exist or another error occurred):\", e);\n      }\n    }\n    if (!columnExists('users', 'ban')) {\n      console.log(\"Attempting to add 'ban' column to users table...\");\n      try {\n        db.exec('ALTER TABLE users ADD COLUMN ban INTEGER DEFAULT 0');\n        console.log(\"'ban' column added to users table.\");\n      } catch (e) {\n        console.error(\"Failed to add 'ban' column to users table (it might already exist or another error occurred):\", e);\n      }\n    }\n  }\n\n  // Events Table\n  const eventsTableExists = tableExists('events');\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS events (\n      id TEXT PRIMARY KEY,\n      name TEXT NOT NULL,\n      date TEXT NOT NULL,\n      endDate TEXT,\n      timeMode TEXT NOT NULL DEFAULT 'specified',\n      isCheckInEnabled INTEGER NOT NULL DEFAULT 1,\n      description TEXT NOT NULL,\n      participantLimit INTEGER,\n      cdKey TEXT NOT NULL UNIQUE,\n      imageUrl TEXT,\n      organizerId TEXT NOT NULL,\n      FOREIGN KEY (organizerId) REFERENCES users(id) ON DELETE CASCADE \n    );\n  `);\n   if (eventsTableExists) {\n    if (!columnExists('events', 'endDate')) {\n      try { db.exec('ALTER TABLE events ADD COLUMN endDate TEXT'); } catch (e) { console.error(\"Failed to add 'endDate' to events:\", e); }\n    }\n    if (!columnExists('events', 'timeMode')) {\n      try { db.exec(\"ALTER TABLE events ADD COLUMN timeMode TEXT NOT NULL DEFAULT 'specified'\"); } catch (e) { console.error(\"Failed to add 'timeMode' to events:\", e); }\n    }\n    if (!columnExists('events', 'isCheckInEnabled')) {\n      try { db.exec(\"ALTER TABLE events ADD COLUMN isCheckInEnabled INTEGER NOT NULL DEFAULT 1\"); } catch (e) { console.error(\"Failed to add 'isCheckInEnabled' to events:\", e); }\n    }\n  }\n\n\n  // Announcements Table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS announcements (\n      id TEXT PRIMARY KEY,\n      title TEXT NOT NULL,\n      content TEXT NOT NULL,\n      date TEXT NOT NULL\n    );\n  `);\n\n  // Event Participants Table\n  db.exec(`\n    CREATE TABLE IF NOT EXISTS event_participants (\n      eventId TEXT NOT NULL,\n      userId TEXT NOT NULL,\n      isCheckedIn INTEGER DEFAULT 0,\n      PRIMARY KEY (eventId, userId),\n      FOREIGN KEY (eventId) REFERENCES events(id) ON DELETE CASCADE,\n      FOREIGN KEY (userId) REFERENCES users(id) ON DELETE CASCADE\n    );\n  `);\n\n  console.log('Schema ensured.');\n\n  // Seed data\n  const userCount = db.prepare('SELECT COUNT(*) as count FROM users').get() as { count: number };\n  if (userCount.count === 0) {\n    console.log('Seeding users table...');\n    const insertUser = db.prepare('INSERT INTO users (id, username, avatarUrl, op, password, qqNumber, ban) VALUES (@id, @username, @avatarUrl, @op, @password, @qqNumber, @ban)');\n    db.transaction(() => {\n      for (const user of defaultUsers) {\n        insertUser.run({\n          ...user,\n          avatarUrl: user.avatarUrl || `https://placehold.co/100x100.png?text=${user.username.substring(0,2)}`,\n          op: user.op || 0,\n          password: user.password || '123456',\n          qqNumber: user.qqNumber || null,\n          ban: user.ban || 0,\n        });\n      }\n    })();\n    console.log('Users table seeded.');\n  } else {\n     console.log('Users table not empty. Ensuring default users exist or are updated...');\n     const upsertUser = db.prepare(`\n      INSERT INTO users (id, username, avatarUrl, op, password, qqNumber, ban) \n      VALUES (@id, @username, @avatarUrl, @op, @password, @qqNumber, @ban)\n      ON CONFLICT(id) DO UPDATE SET\n        username = excluded.username,\n        avatarUrl = COALESCE(excluded.avatarUrl, users.avatarUrl),\n        op = COALESCE(excluded.op, users.op),\n        password = COALESCE(excluded.password, users.password),\n        qqNumber = excluded.qqNumber, \n        ban = COALESCE(excluded.ban, users.ban)\n      WHERE users.id = excluded.id;\n    `);\n     db.transaction(() => {\n        for (const user of defaultUsers) {\n            upsertUser.run({\n                ...user,\n                avatarUrl: user.avatarUrl || `https://placehold.co/100x100.png?text=${user.username.substring(0,2)}`,\n                op: user.op || 0,\n                password: user.password || '123456',\n                qqNumber: user.qqNumber || null,\n                ban: user.ban || 0,\n            });\n        }\n     })();\n     console.log('Default users upserted.');\n  }\n\n\n  const eventCount = db.prepare('SELECT COUNT(*) as count FROM events').get() as { count: number };\n  if (eventCount.count === 0) {\n    console.log('Seeding events and event_participants tables...');\n    const insertEvent = db.prepare('INSERT INTO events (id, name, date, endDate, timeMode, isCheckInEnabled, description, participantLimit, cdKey, imageUrl, organizerId) VALUES (@id, @name, @date, @endDate, @timeMode, @isCheckInEnabled, @description, @participantLimit, @cdKey, @imageUrl, @organizerId)');\n    const insertParticipant = db.prepare('INSERT INTO event_participants (eventId, userId, isCheckedIn) VALUES (@eventId, @userId, @isCheckedIn)');\n    \n    db.transaction(() => {\n      for (const event of defaultEvents) {\n        insertEvent.run({\n          ...event,\n          endDate: event.endDate || null,\n          timeMode: event.timeMode || 'specified',\n          isCheckInEnabled: event.isCheckInEnabled === undefined ? 1 : (event.isCheckInEnabled ? 1 : 0),\n          participantLimit: event.participantLimit || null,\n        });\n        for (const p of event.participants) {\n          const userExists = db.prepare('SELECT id FROM users WHERE id = ?').get(p.id);\n          if (userExists) {\n            insertParticipant.run({\n              eventId: event.id,\n              userId: p.id,\n              isCheckedIn: p.isCheckedIn ? 1 : 0\n            });\n          } else {\n            console.warn(`Skipping participant ${p.id} for event ${event.id} as user does not exist.`);\n          }\n        }\n      }\n    })();\n    console.log('Events and event_participants tables seeded.');\n  }\n  \n  const announcementCount = db.prepare('SELECT COUNT(*) as count FROM announcements').get() as { count: number };\n  if (announcementCount.count === 0) {\n    console.log('Seeding announcements table...');\n    const insertAnnouncement = db.prepare('INSERT INTO announcements (id, title, content, date) VALUES (@id, @title, @content, @date)');\n    db.transaction(() => {\n      for (const announcement of defaultAnnouncements) {\n        insertAnnouncement.run(announcement);\n      }\n    })();\n    console.log('Announcements table seeded.');\n  }\n}\n\ntry {\n  initializeDatabase();\n} catch (err) {\n  console.error(\"CRITICAL: Database initialization failed:\", err);\n}\n\nexport default db;\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 460, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/data.ts"],"sourcesContent":["\nimport db from './db';\nimport type { Event, User, Participant, Announcement } from './types';\nimport { parseISO } from 'date-fns'; // Keep for potential date logic if needed elsewhere\n\n// --- User Functions ---\nexport async function getUsers(): Promise<User[]> {\n  const stmt = db.prepare('SELECT id, username, avatarUrl, op, password, qqNumber, ban FROM users');\n  return stmt.all() as User[];\n}\n\nexport async function getUserById(userId: string): Promise<User | undefined> {\n  const stmt = db.prepare('SELECT id, username, avatarUrl, op, password, qqNumber, ban FROM users WHERE id = ?');\n  return stmt.get(userId) as User | undefined;\n}\n\nexport async function getUserByUsername(username: string): Promise<User | undefined> {\n  const stmt = db.prepare('SELECT id, username, avatarUrl, op, password, qqNumber, ban FROM users WHERE lower(username) = lower(?)');\n  return stmt.get(username) as User | undefined;\n}\n\nexport async function getUserByQQNumber(qqNumber: string): Promise<User | undefined> {\n  if (!qqNumber || qqNumber.trim() === '') return undefined;\n  const stmt = db.prepare('SELECT id, username, avatarUrl, op, password, qqNumber, ban FROM users WHERE qqNumber = ?');\n  return stmt.get(qqNumber) as User | undefined;\n}\n\nexport async function createUser(userData: Omit<User, 'id'> & { id?: string }): Promise<User> {\n  const userId = userData.id || userData.username; // Use username as ID if not provided\n  const existingUser = await getUserByUsername(userId); // Use userId (which might be username)\n  if (existingUser) {\n    console.warn(`Attempting to create an already existing user by ID/username: ${userId}. Returning existing user.`);\n    return existingUser;\n  }\n  if (userData.qqNumber) {\n    const existingUserByQQ = await getUserByQQNumber(userData.qqNumber);\n    if (existingUserByQQ) {\n      throw new Error(`QQ number ${userData.qqNumber} is already in use.`);\n    }\n  }\n\n  const newUser: User = {\n    id: userId,\n    username: userData.username,\n    avatarUrl: userData.avatarUrl || `https://placehold.co/100x100.png?text=${userData.username.substring(0, 2).toUpperCase()}`,\n    op: userData.op || 0,\n    password: userData.password,\n    qqNumber: userData.qqNumber || undefined, // Store as undefined if not provided, DB will handle NULL\n    ban: userData.ban || 0,\n  };\n\n  const stmt = db.prepare('INSERT INTO users (id, username, avatarUrl, op, password, qqNumber, ban) VALUES (@id, @username, @avatarUrl, @op, @password, @qqNumber, @ban)');\n  try {\n    stmt.run({\n      ...newUser,\n      qqNumber: newUser.qqNumber || null, // Ensure DB gets NULL for undefined\n      ban: newUser.ban || 0,\n    });\n    const createdUser = await getUserById(userId); // Fetch to confirm creation and get all fields\n    if (!createdUser) throw new Error(\"User creation failed or user not found after creation.\");\n    return createdUser;\n  } catch (error) {\n    console.error(`Failed to create user ${userData.username}:`, error);\n    throw new Error(`Failed to create user ${userData.username}: ${(error as Error).message}`);\n  }\n}\n\nexport async function updateUserById(userId: string, userData: Partial<Omit<User, 'id'>>): Promise<User | null> {\n  const currentUser = await getUserById(userId);\n  if (!currentUser) return null;\n\n  const fieldsToUpdate: Record<string, any> = {};\n  if (userData.username !== undefined) fieldsToUpdate.username = userData.username;\n  if (userData.avatarUrl !== undefined) fieldsToUpdate.avatarUrl = userData.avatarUrl;\n  if (userData.op !== undefined) fieldsToUpdate.op = userData.op;\n  if (userData.password !== undefined && userData.password !== '') fieldsToUpdate.password = userData.password;\n  if (userData.qqNumber !== undefined) fieldsToUpdate.qqNumber = userData.qqNumber || null; // Handle empty string as null\n  if (userData.ban !== undefined) fieldsToUpdate.ban = userData.ban;\n\n\n  if (Object.keys(fieldsToUpdate).length === 0) {\n    return currentUser;\n  }\n\n  const setClauses = Object.keys(fieldsToUpdate).map(key => `${key} = @${key}`).join(', ');\n  const stmt = db.prepare(`UPDATE users SET ${setClauses} WHERE id = @id`);\n  \n  const result = stmt.run({ ...fieldsToUpdate, id: userId });\n  if (result.changes === 0 && !(Object.keys(fieldsToUpdate).length === 1 && fieldsToUpdate.qqNumber === null && currentUser.qqNumber === null) ) { // No rows affected, and it wasn't just setting an already null qqNumber to null\n     console.warn(`Update for user ${userId} resulted in 0 changes. Data:`, userData);\n     // Potentially return null or current user depending on desired behavior for \"no change\" updates\n  }\n\n  return getUserById(userId);\n}\n\nexport async function deleteUserById(userId: string): Promise<{ success: boolean, message: string }> {\n  const eventOrganizerCheckStmt = db.prepare('SELECT COUNT(*) as count FROM events WHERE organizerId = ?');\n  const organizerCount = eventOrganizerCheckStmt.get(userId) as { count: number };\n\n  if (organizerCount.count > 0) {\n    return { success: false, message: `无法删除用户 ${userId}，因为他们是 ${organizerCount.count} 个活动的组织者。请先转移或删除这些活动。` };\n  }\n\n  const deleteUserStmt = db.prepare('DELETE FROM users WHERE id = ?');\n  const result = deleteUserStmt.run(userId);\n\n  if (result.changes > 0) {\n    return { success: true, message: `用户 ${userId} 已成功删除。` };\n  }\n  return { success: false, message: `用户 ${userId} 未找到，无法删除。` };\n}\n\n\n// --- Event Functions ---\nasync function getEventParticipants(eventId: string): Promise<Participant[]> {\n  const stmt = db.prepare(`\n    SELECT u.id, u.username, u.avatarUrl, u.op, u.password, u.qqNumber, u.ban, ep.isCheckedIn \n    FROM users u\n    JOIN event_participants ep ON u.id = ep.userId\n    WHERE ep.eventId = ?\n  `);\n  const participantsData = stmt.all(eventId) as Array<Omit<Participant, 'joinedEventIds'>>;\n  return participantsData.map(p => ({...p, isCheckedIn: !!p.isCheckedIn, ban: p.ban || 0, qqNumber: p.qqNumber || undefined }));\n}\n\nexport async function getEvents(): Promise<Event[]> {\n  const eventsStmt = db.prepare('SELECT id, name, date, endDate, timeMode, isCheckInEnabled, description, participantLimit, cdKey, imageUrl, organizerId FROM events');\n  const rawEvents = eventsStmt.all() as Array<Omit<Event, 'participants'>>;\n  \n  const events: Event[] = [];\n  for (const rawEvent of rawEvents) {\n    const participants = await getEventParticipants(rawEvent.id);\n    events.push({ ...rawEvent, participants, isCheckInEnabled: !!rawEvent.isCheckInEnabled });\n  }\n  return events;\n}\n\nexport async function getEventById(id: string): Promise<Event | undefined> {\n  const eventStmt = db.prepare('SELECT id, name, date, endDate, timeMode, isCheckInEnabled, description, participantLimit, cdKey, imageUrl, organizerId FROM events WHERE id = ?');\n  const rawEvent = eventStmt.get(id) as Omit<Event, 'participants'> | undefined;\n\n  if (!rawEvent) return undefined;\n\n  const participants = await getEventParticipants(rawEvent.id);\n  return { ...rawEvent, participants, isCheckInEnabled: !!rawEvent.isCheckInEnabled };\n}\n\nexport async function getEventsForUser(userId: string): Promise<Event[]> {\n  const stmt = db.prepare(`\n    SELECT e.id, e.name, e.date, e.endDate, e.timeMode, e.isCheckInEnabled, e.description, e.participantLimit, e.cdKey, e.imageUrl, e.organizerId\n    FROM events e\n    JOIN event_participants ep ON e.id = ep.eventId\n    WHERE ep.userId = ?\n  `);\n  const rawEvents = stmt.all(userId) as Array<Omit<Event, 'participants'>>;\n  \n  const joinedEvents: Event[] = [];\n  for (const rawEvent of rawEvents) {\n    const participants = await getEventParticipants(rawEvent.id);\n    joinedEvents.push({ ...rawEvent, participants, isCheckInEnabled: !!rawEvent.isCheckInEnabled });\n  }\n  return joinedEvents;\n}\n\nexport async function getEventByCdKey(cdKey: string): Promise<Event | undefined> {\n  const eventStmt = db.prepare('SELECT id, name, date, endDate, timeMode, isCheckInEnabled, description, participantLimit, cdKey, imageUrl, organizerId FROM events WHERE lower(cdKey) = lower(?)');\n  const rawEvent = eventStmt.get(cdKey) as Omit<Event, 'participants'> | undefined;\n\n  if (!rawEvent) return undefined;\n\n  const participants = await getEventParticipants(rawEvent.id);\n  return { ...rawEvent, participants, isCheckInEnabled: !!rawEvent.isCheckInEnabled };\n}\n\nexport async function createEvent(eventData: Omit<Event, 'id' | 'participants' | 'organizerId'>, organizerId: string): Promise<Event> {\n  const newEventId = `event_${Date.now()}_${Math.random().toString(36).substring(2, 7)}`;\n  \n  let finalCdKey = eventData.cdKey;\n  if (eventData.timeMode === 'long-term') {\n    finalCdKey = `LT-${Date.now()}${Math.random().toString(36).slice(2, 8)}`;\n  }\n\n  const newEventRow = {\n    id: newEventId,\n    name: eventData.name,\n    date: eventData.date,\n    endDate: eventData.timeMode === 'specified' ? (eventData.endDate || null) : null,\n    timeMode: eventData.timeMode,\n    isCheckInEnabled: eventData.timeMode === 'long-term' ? 0 : (eventData.isCheckInEnabled ? 1 : 0),\n    description: eventData.description,\n    participantLimit: typeof eventData.participantLimit === 'number' && !isNaN(eventData.participantLimit) ? eventData.participantLimit : null,\n    cdKey: finalCdKey,\n    imageUrl: eventData.imageUrl || '',\n    organizerId,\n  };\n  const stmt = db.prepare('INSERT INTO events (id, name, date, endDate, timeMode, isCheckInEnabled, description, participantLimit, cdKey, imageUrl, organizerId) VALUES (@id, @name, @date, @endDate, @timeMode, @isCheckInEnabled, @description, @participantLimit, @cdKey, @imageUrl, @organizerId)');\n  stmt.run(newEventRow);\n  const createdEvent = await getEventById(newEventId);\n  if (!createdEvent) throw new Error(\"Failed to retrieve event after creation.\");\n  return createdEvent;\n}\n\nexport async function updateEventById(eventId: string, eventData: Partial<Omit<Event, 'id' | 'participants' | 'organizerId'>>): Promise<Event | null> {\n  const currentEvent = await getEventById(eventId);\n  if (!currentEvent) return null;\n\n  const fieldsToUpdate: Record<string, any> = {};\n  if (eventData.name !== undefined) fieldsToUpdate.name = eventData.name;\n  if (eventData.date !== undefined) fieldsToUpdate.date = eventData.date;\n  if (eventData.description !== undefined) fieldsToUpdate.description = eventData.description;\n  \n  if (eventData.timeMode !== undefined) {\n    fieldsToUpdate.timeMode = eventData.timeMode;\n    if (eventData.timeMode === 'long-term') {\n      fieldsToUpdate.endDate = null;\n      fieldsToUpdate.isCheckInEnabled = 0;\n      // CD Key for long-term events is typically not user-editable after creation or auto-generated\n      // If cdKey is empty for a long-term event being updated, we might regenerate, or leave as is.\n      // For now, let's assume cdKey is not changed for long-term during update unless explicitly provided.\n      if (eventData.cdKey === undefined || eventData.cdKey === '') {\n         // Keep existing cdKey if not specified, or generate if it was somehow empty.\n         fieldsToUpdate.cdKey = currentEvent.cdKey || `LT-${Date.now()}${Math.random().toString(36).slice(2, 8)}`;\n      } else {\n         fieldsToUpdate.cdKey = eventData.cdKey;\n      }\n    } else { // 'specified'\n      fieldsToUpdate.endDate = eventData.endDate || null;\n      if (eventData.isCheckInEnabled !== undefined) fieldsToUpdate.isCheckInEnabled = eventData.isCheckInEnabled ? 1 : 0;\n      if (eventData.cdKey !== undefined) fieldsToUpdate.cdKey = eventData.cdKey;\n    }\n  } else { // timeMode not changing, but other fields might\n    if (eventData.endDate !== undefined) fieldsToUpdate.endDate = eventData.endDate || null;\n    if (eventData.isCheckInEnabled !== undefined) fieldsToUpdate.isCheckInEnabled = eventData.isCheckInEnabled ? 1 : 0;\n    if (eventData.cdKey !== undefined) fieldsToUpdate.cdKey = eventData.cdKey;\n  }\n\n  if (eventData.participantLimit !== undefined) {\n    fieldsToUpdate.participantLimit = typeof eventData.participantLimit === 'number' && !isNaN(eventData.participantLimit) ? eventData.participantLimit : null;\n  }\n  if (eventData.imageUrl !== undefined) fieldsToUpdate.imageUrl = eventData.imageUrl;\n\n\n  if (Object.keys(fieldsToUpdate).length === 0) {\n    return getEventById(eventId) || null;\n  }\n\n  const setClauses = Object.keys(fieldsToUpdate).map(key => `${key} = @${key}`).join(', ');\n  const stmt = db.prepare(`UPDATE events SET ${setClauses} WHERE id = @eventId`);\n  \n  stmt.run({ ...fieldsToUpdate, eventId });\n  \n  return getEventById(eventId);\n}\n\nexport async function deleteEventById(eventId: string): Promise<{ success: boolean, message: string }> {\n  const stmt = db.prepare('DELETE FROM events WHERE id = ?');\n  const result = stmt.run(eventId);\n\n  if (result.changes > 0) {\n    return { success: true, message: \"活动已成功删除。\" };\n  }\n  return { success: false, message: \"活动未找到，无法删除。\" };\n}\n\nexport async function joinEvent(userId: string, eventId: string, cdKeyInput: string): Promise<{ success: boolean, message: string, event?: Event }> {\n  const event = await getEventById(eventId);\n  if (!event) return { success: false, message: '活动未找到。' };\n\n  const user = await getUserById(userId);\n  if (!user) return { success: false, message: '用户未找到。' };\n  if (user.ban === 1) return { success: false, message: '您的账户已被封禁，无法加入活动。' };\n\n  if (event.timeMode === 'long-term') {\n    // Long-term events might not use CD-Keys for joining in the same way,\n    // or cdKeyInput might be an empty string if not applicable.\n    // For now, if a CD-Key is present for a long-term event, it must match.\n    // Or, if no CD-Key is expected for joining long-term, this check could be skipped or modified.\n    // Current logic: if cdKey is set on a long-term event, it still needs to be matched if input is given.\n    if (event.cdKey && cdKeyInput.toLowerCase() !== event.cdKey.toLowerCase()) {\n       return { success: false, message: '无效的活动代码。' };\n    }\n  } else if (event.cdKey.toLowerCase() !== cdKeyInput.toLowerCase()) {\n    return { success: false, message: '无效的活动代码。' };\n  }\n  \n  const currentParticipants = await getEventParticipants(eventId);\n  if (event.participantLimit && currentParticipants.length >= event.participantLimit) {\n    return { success: false, message: '活动人数已满。' };\n  }\n  if (currentParticipants.some(p => p.id === userId)) {\n    return { success: true, message: '您已加入此活动。', event };\n  }\n\n  const stmt = db.prepare('INSERT INTO event_participants (eventId, userId, isCheckedIn) VALUES (?, ?, 0)');\n  stmt.run(eventId, userId);\n  \n  const finalEvent = await getEventById(eventId);\n  return { success: true, message: '成功加入活动！', event: finalEvent };\n}\n\nexport async function leaveEvent(userId: string, eventId: string): Promise<{ success: boolean, message: string, event?: Event }> {\n  const event = await getEventById(eventId);\n  if (!event) return { success: false, message: '活动未找到。' };\n\n  const stmt = db.prepare('DELETE FROM event_participants WHERE eventId = ? AND userId = ?');\n  const result = stmt.run(eventId, userId);\n\n  if (result.changes > 0) {\n    const updatedEvent = await getEventById(eventId);\n    return { success: true, message: '成功离开活动。', event: updatedEvent };\n  }\n  return { success: false, message: '您当前未加入此活动，或离开失败。' };\n}\n\nexport async function checkInUser(userId: string, eventId: string): Promise<{ success: boolean, message: string }> {\n  const event = await getEventById(eventId);\n  if (!event) return { success: false, message: '活动未找到。' };\n\n  if (!event.isCheckInEnabled) return { success: false, message: '此活动未开启签到功能。'};\n  if (event.timeMode === 'long-term') return { success: false, message: '长期活动无需签到。'};\n\n  const participants = await getEventParticipants(eventId);\n  const participant = participants.find(p => p.id === userId);\n\n  if (!participant) return { success: false, message: '您未报名参加此活动。' };\n  if (participant.isCheckedIn) return { success: true, message: '您已签到。' };\n\n  const { getEventStatus } = await import('./event-utils'); // Dynamic import for server-side util\n  const eventStatus = getEventStatus(event);\n\n\n  if (eventStatus !== 'current') {\n    return { success: false, message: '此活动的签到尚未开始或已结束。' };\n  }\n\n  const stmt = db.prepare('UPDATE event_participants SET isCheckedIn = 1 WHERE eventId = ? AND userId = ?');\n  stmt.run(eventId, userId);\n  return { success: true, message: '签到成功！' };\n}\n\n// --- Announcement Functions ---\nexport async function getAnnouncements(): Promise<Announcement[]> {\n  const stmt = db.prepare('SELECT id, title, content, date FROM announcements ORDER BY date DESC');\n  return stmt.all() as Announcement[];\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 865, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/namemc.ts"],"sourcesContent":["\n'use server';\n\n/**\n * @fileOverview Mocks a check to NameMC to see if a username is valid.\n */\n\n/**\n * Mocks a check to NameMC to see if a username is valid.\n * In a real application, this would involve an API call to NameMC.\n * @param username The Minecraft username to check.\n * @returns Promise<boolean> True if the username is considered valid, false otherwise.\n */\nexport async function checkNameMC(username: string): Promise<boolean> {\n  console.log(`Pretending to check NameMC for username: ${username}`);\n  // In a real scenario:\n  // try {\n  //   // Example: const response = await fetch(`https://api.namemc.com/profile/${username}/uuid`);\n  //   // return response.ok;\n  // } catch (error) {\n  //   console.error(\"NameMC check failed:\", error);\n  //   return false;\n  // }\n\n  // For testing the \"invalid\" path in the login flow\n  if (username.toLowerCase() === \"invalid_player_for_testing\") {\n    console.log(`Mock: Username \"${username}\" is considered invalid by NameMC.`);\n    return false;\n  }\n\n  // Mock: assume most usernames are valid for now\n  console.log(`Mock: Username \"${username}\" is considered valid by NameMC.`);\n  return true;\n}\n"],"names":[],"mappings":";;;;;;;;AAaO,eAAe,uCAAS,GAAT,YAAY,QAAgB;IAChD,QAAQ,GAAG,CAAC,CAAC,yCAAyC,EAAE,UAAU;IAClE,sBAAsB;IACtB,QAAQ;IACR,iGAAiG;IACjG,2BAA2B;IAC3B,oBAAoB;IACpB,kDAAkD;IAClD,kBAAkB;IAClB,IAAI;IAEJ,mDAAmD;IACnD,IAAI,SAAS,WAAW,OAAO,8BAA8B;QAC3D,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,SAAS,kCAAkC,CAAC;QAC3E,OAAO;IACT;IAEA,gDAAgD;IAChD,QAAQ,GAAG,CAAC,CAAC,gBAAgB,EAAE,SAAS,gCAAgC,CAAC;IACzE,OAAO;AACT;;;IApBsB;;AAAA,+OAAA","debugId":null}},
    {"offset": {"line": 903, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/actions.ts"],"sourcesContent":["\n'use server';\n\nimport { cookies } from 'next/headers';\nimport { redirect } from 'next/navigation';\nimport { z, ZodError } from 'zod';\nimport {\n  createEvent as apiCreateEvent,\n  joinEvent as apiJoinEvent,\n  leaveEvent as apiLeaveEvent,\n  checkInUser as apiCheckInUser,\n  getUserById,\n  getUserByUsername,\n  getUserByQQNumber, \n  getEventById,\n  getEvents as apiGetEvents,\n  createUser as apiCreateUser,\n  getEventByCdKey,\n  getAnnouncements as apiGetAnnouncements,\n  deleteEventById as apiDeleteEventById,\n  updateEventById as apiUpdateEventById,\n  getUsers as apiGetUsers,\n  updateUserById as apiUpdateUserById,\n  deleteUserById as apiDeleteUserById,\n  getEventsForUser,\n} from './data';\nimport type { Event, User, Announcement, AdminAddUserFormState, AdminUpdateUserFormState, ServerAuthFormState } from './types';\nimport { checkNameMC } from './namemc';\n\n\nconst MAX_AGE = 60 * 60 * 24 * 30; // 30 days\n\n// --- SCHEMAS ---\nconst MinecraftUsernameSchema = z.string()\n  .min(3, \"Minecraft 用户名长度必须在 3 到 16 个字符之间。\")\n  .max(16, \"Minecraft 用户名长度必须在 3 到 16 个字符之间。\")\n  .regex(/^[a-zA-Z0-9_]+$/, \"Minecraft 用户名只能包含字母、数字和下划线。\")\n  .refine(username => !username.startsWith('_') && !username.endsWith('_'), {\n    message: \"Minecraft 用户名不能以下划线开头或结尾。\",\n  });\n\nconst PasswordSchema = z.string().min(6, \"密码至少需要6个字符。\");\n\nconst QQNumberSchema = z.string()\n  .regex(/^[0-9]{5,15}$/, \"QQ号必须是5到15位数字。\")\n  .optional()\n  .or(z.literal('')); // Allow empty string, which will be treated as optional\n\nconst LoginSchema = z.object({\n  authMode: z.literal('login'),\n  minecraftUsername: MinecraftUsernameSchema,\n  password: PasswordSchema,\n  // QQ Number is not part of login schema\n});\n\nconst RegisterSchema = z.object({\n  authMode: z.literal('register'),\n  minecraftUsername: MinecraftUsernameSchema,\n  password: PasswordSchema,\n  confirmPassword: PasswordSchema,\n  qqNumber: QQNumberSchema,\n}).refine(data => data.password === data.confirmPassword, {\n  message: \"两次输入的密码不匹配。\",\n  path: [\"confirmPassword\"],\n});\n\nconst AuthFormSchema = z.discriminatedUnion(\"authMode\", [LoginSchema, RegisterSchema]);\n\n\nexport async function authenticateUserAction(prevState: ServerAuthFormState, formData: FormData): Promise<ServerAuthFormState> {\n  const rawFormData = Object.fromEntries(formData.entries());\n  console.log(\"authenticateUserAction: Received rawFormData:\", rawFormData);\n\n  const validatedFields = AuthFormSchema.safeParse(rawFormData);\n\n  if (!validatedFields.success) {\n    console.error(\"authenticateUserAction: Zod validation failed:\", validatedFields.error.flatten().fieldErrors);\n    return {\n      message: '输入无效。请检查您填写的信息。',\n      errors: validatedFields.error.flatten().fieldErrors as ServerAuthFormState['errors'],\n      success: false,\n    };\n  }\n  \n  const { authMode } = validatedFields.data;\n\n  try {\n    let sessionUserIdToSet: string | undefined = undefined;\n    let successMessage: string = '';\n    let userToProcess: User | null = null;\n\n    if (authMode === 'login') {\n      const { minecraftUsername, password } = validatedFields.data;\n      console.log(`authenticateUserAction: Attempting login for user \"${minecraftUsername}\"`);\n      const user = await getUserByUsername(minecraftUsername);\n\n      if (!user) {\n        return { message: '用户不存在或密码错误。', errors: { form: ['用户不存在或密码错误。'] }, success: false };\n      }\n      if (user.ban === 1) {\n        return { message: '您的账户已被封禁，请联系管理员。', errors: { form: ['您的账户已被封禁，请联系管理员。'] }, success: false };\n      }\n      if (!user.password || user.password !== password) {\n        return { message: '用户不存在或密码错误。', errors: { form: ['用户不存在或密码错误。'] }, success: false };\n      }\n      sessionUserIdToSet = user.id;\n      successMessage = '登录成功！即将跳转...';\n      \n    } else if (authMode === 'register') {\n      const { minecraftUsername, password, qqNumber } = validatedFields.data;\n      console.log(`authenticateUserAction: Attempting registration for user \"${minecraftUsername}\", QQ: \"${qqNumber}\"`);\n\n      const isNameMCValid = await checkNameMC(minecraftUsername);\n      if (!isNameMCValid) {\n        return { message: '此 Minecraft 用户名在 NameMC 上无效或无法验证。', errors: { minecraftUsername: ['此 Minecraft 用户名在 NameMC 上无效或无法验证。'] }, success: false };\n      }\n\n      const existingUserByUsername = await getUserByUsername(minecraftUsername);\n      if (existingUserByUsername) {\n        return { message: '此 Minecraft 用户名已被注册。', errors: { minecraftUsername: ['此 Minecraft 用户名已被注册。'] }, success: false };\n      }\n\n      let finalQQToRegister: string | undefined = qqNumber || undefined;\n\n      if (finalQQToRegister && finalQQToRegister.trim() !== '') {\n        const existingUserByQQ = await getUserByQQNumber(finalQQToRegister);\n        if (existingUserByQQ) {\n          return { message: '此 QQ 号码已被其他用户绑定。', errors: { qqNumber: ['此 QQ 号码已被其他用户绑定。'] }, success: false };\n        }\n      } else { // User did not provide a QQ number or it's an empty string\n        let randomQQ: string;\n        let attempts = 0;\n        const MAX_ATTEMPTS = 20;\n        do {\n          if (attempts >= MAX_ATTEMPTS) {\n            return { message: '系统暂时无法分配唯一的QQ号，请稍后重试或联系管理员。', errors: { form: ['无法生成唯一的QQ号。'] }, success: false };\n          }\n          randomQQ = Math.floor(100000000 + Math.random() * 900000000).toString(); // Generate 9-digit random QQ\n          const existingUserByRandomQQ = await getUserByQQNumber(randomQQ);\n          if (!existingUserByRandomQQ) {\n            finalQQToRegister = randomQQ;\n            break;\n          }\n          attempts++;\n        } while (true);\n        console.log(`Generated unique QQ number for ${minecraftUsername}: ${finalQQToRegister}`);\n      }\n      \n      const newUser = await apiCreateUser({\n        id: minecraftUsername, // Using username as ID for new users\n        username: minecraftUsername,\n        password: password,\n        op: 0,\n        avatarUrl: `https://placehold.co/100x100.png?text=${minecraftUsername.substring(0,2).toUpperCase()}`,\n        qqNumber: finalQQToRegister,\n        ban: 0,\n      });\n\n      if (!newUser || !newUser.id) {\n         return { message: '创建用户后未能获取用户信息。', errors: { form: ['创建用户后未能获取用户信息。'] }, success: false };\n      }\n      sessionUserIdToSet = newUser.id;\n      successMessage = '账户创建成功！即将跳转...';\n    }\n\n    if (sessionUserIdToSet) {\n      cookies().set('userId', sessionUserIdToSet, { httpOnly: true, secure: process.env.NODE_ENV === 'production', maxAge: MAX_AGE, path: '/', sameSite: 'lax' });\n      // Client will handle redirect after showing toast\n      return { success: true, message: successMessage, userId: sessionUserIdToSet };\n    } else {\n      return { message: '认证过程出现意外，未能设置用户会话。', success: false, errors: {form: ['认证过程出现意外，未能设置用户会话。']} };\n    }\n\n  } catch (error: any) {\n    if (error && typeof error === 'object' && 'digest' in error && typeof error.digest === 'string' && error.digest.startsWith('NEXT_REDIRECT')) {\n      throw error;\n    }\n    console.error(\"authenticateUserAction - Top-level Server Error:\", error);\n    const errorMessage = error instanceof Error ? error.message : '认证过程中发生服务器内部错误。';\n    return { message: errorMessage, success: false, errors: { form: [errorMessage]} };\n  }\n}\n\nexport async function logout() {\n  cookies().delete('userId');\n  redirect('/login');\n}\n\nexport async function getSessionUser(): Promise<User | null> {\n  const userId = cookies().get('userId')?.value;\n  if (!userId) return null;\n  try {\n    const user = await getUserById(userId); \n    if (!user) {\n        cookies().delete('userId');\n        return null;\n    }\n    return user;\n  } catch (error) {\n    console.error(\"getSessionUser - Error fetching user:\", error);\n    return null;\n  }\n}\n\n// --- Event Actions ---\nconst EventBaseSchema = z.object({\n  name: z.string().min(3, \"活动名称至少需要3个字符。\"),\n  description: z.string().min(10, \"描述至少需要10个字符。\"),\n  participantLimit: z.preprocess(\n    (val) => (val === \"\" || val === null || val === undefined ? null : Number(val)),\n    z.number().int().positive().optional().nullable()\n  ),\n  imageUrl: z.string().url(\"无效的图片链接。\").optional().or(z.literal('')),\n  timeMode: z.enum(['specified', 'long-term']),\n  isCheckInEnabled: z.preprocess(val => val === 'on' || val === true, z.boolean().default(true)),\n  userPassword: z.string().min(1, \"您的账户密码不能为空。\")\n});\n\nconst SpecifiedTimeEventSchema = EventBaseSchema.extend({\n  timeMode: z.literal('specified'),\n  date: z.string().refine((date) => !isNaN(Date.parse(date)), \"无效的开始日期格式。\"),\n  endDate: z.string().optional().nullable().refine(val => val === null || val === '' || !isNaN(Date.parse(val)), \"无效的结束日期格式。\"),\n  cdKey: z.string().min(4, \"活动代码至少需要4个字符。\").max(20, \"活动代码最多20个字符。\"),\n});\n\nconst LongTermEventSchema = EventBaseSchema.extend({\n  timeMode: z.literal('long-term'),\n  date: z.string().refine((date) => !isNaN(Date.parse(date)), \"无效的开始日期格式。\"),\n  // For long-term, cdKey is auto-generated, endDate is null, isCheckInEnabled is false\n});\n\nconst CreateEventFormSchema = z.discriminatedUnion(\"timeMode\", [SpecifiedTimeEventSchema, LongTermEventSchema]);\nconst UpdateEventFormSchema = CreateEventFormSchema.extend({\n  eventId: z.string().min(1, \"Event ID is required.\"),\n});\n\n\nexport async function createEventAction(prevState: any, formData: FormData) {\n  const user = await getSessionUser();\n  if (!user) {\n    return { message: '需要认证才能创建活动。请先登录。', errors: { form: ['请先登录。'] }, success: false };\n  }\n  if (user.op !== 1 && user.op !== 2) { // Admin or Co-admin\n    return { message: '您没有创建活动的权限。', errors: { form: ['权限不足。'] }, success: false };\n  }\n\n  const rawFormData = Object.fromEntries(formData.entries());\n   // Convert 'isCheckInEnabled' checkbox value\n  if (rawFormData.isCheckInEnabled === 'on') {\n    rawFormData.isCheckInEnabled = true;\n  } else {\n    rawFormData.isCheckInEnabled = false;\n  }\n\n\n  const validatedFields = CreateEventFormSchema.safeParse(rawFormData);\n\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: '创建活动失败。请检查所填字段。',\n      success: false,\n    };\n  }\n\n  if (!user.password || user.password !== validatedFields.data.userPassword) {\n    return {\n      errors: { ...(validatedFields.error?.flatten().fieldErrors || {}), userPassword: ['您的账户密码不正确。'] },\n      message: '创建活动失败。账户密码验证失败。',\n      success: false,\n    };\n  }\n  \n  const { userPassword, ...eventDataForApi } = validatedFields.data;\n  \n  let finalData: Omit<Event, 'id' | 'participants' | 'organizerId'>;\n\n  if (eventDataForApi.timeMode === 'long-term') {\n    finalData = {\n      ...eventDataForApi,\n      cdKey: `LT-${Date.now()}${Math.random().toString(36).slice(2, 8)}`, // Auto-generate\n      endDate: null,\n      isCheckInEnabled: false,\n    };\n  } else { // specified time\n    finalData = {\n      ...eventDataForApi,\n      endDate: eventDataForApi.endDate || null, // Ensure null if empty string\n      isCheckInEnabled: eventDataForApi.isCheckInEnabled,\n    };\n  }\n\n  try {\n    const newEvent = await apiCreateEvent(finalData, user.id);\n    redirect(`/events/${newEvent.id}`);\n  } catch (error: any) {\n    if (error && typeof error === 'object' && 'digest' in error && error.digest?.startsWith('NEXT_REDIRECT')) {\n      throw error;\n    }\n    console.error(\"Create Event Action - Server Error:\", error);\n    return { message: `创建活动时发生意外的服务器错误: ${error.message}`, errors: { form: [`创建活动时发生意外的服务器错误: ${error.message}`] }, success: false };\n  }\n}\n\nexport async function updateEventAction(prevState: any, formData: FormData) {\n   const user = await getSessionUser();\n  if (!user) {\n    return { message: '需要认证才能更新活动。请先登录。', errors: { form: ['请先登录。'] }, success: false };\n  }\n  if (user.op !== 1 && user.op !== 2) { // Admin or Co-admin\n    return { message: '您没有更新活动的权限。', errors: { form: ['权限不足。'] }, success: false };\n  }\n  \n  const rawFormData = Object.fromEntries(formData.entries());\n  if (rawFormData.isCheckInEnabled === 'on') {\n    rawFormData.isCheckInEnabled = true;\n  } else {\n    rawFormData.isCheckInEnabled = false;\n  }\n\n  const validatedFields = UpdateEventFormSchema.safeParse(rawFormData);\n\n  if (!validatedFields.success) {\n    return {\n      errors: validatedFields.error.flatten().fieldErrors,\n      message: '更新活动失败。请检查所填字段。',\n      success: false,\n    };\n  }\n  \n  if (!user.password || user.password !== validatedFields.data.userPassword) {\n    return {\n      errors: { ...(validatedFields.error?.flatten().fieldErrors || {}), userPassword: ['您的账户密码不正确。'] },\n      message: '更新活动失败。账户密码验证失败。',\n      success: false,\n    };\n  }\n\n  const { userPassword, eventId, ...eventDataToUpdate } = validatedFields.data;\n  let finalData: Partial<Omit<Event, 'id' | 'participants' | 'organizerId'>>;\n\n  if (eventDataToUpdate.timeMode === 'long-term') {\n    finalData = {\n      ...eventDataToUpdate,\n      endDate: null,\n      isCheckInEnabled: false,\n      // cdKey for long-term generally not changed by user after creation\n      // If it was auto-generated, it remains. If it was user-set (not typical for long-term), it could be updated if form allows.\n      // For now, if cdKey is part of eventDataToUpdate and timeMode is long-term, it will be passed.\n      // Otherwise, ensure it's not accidentally blanked.\n      cdKey: eventDataToUpdate.cdKey || (await getEventById(eventId))?.cdKey || `LT-${Date.now()}${Math.random().toString(36).slice(2, 8)}`\n    };\n  } else { // specified time\n    finalData = {\n      ...eventDataToUpdate,\n      endDate: eventDataToUpdate.endDate || null,\n      isCheckInEnabled: eventDataToUpdate.isCheckInEnabled,\n    };\n  }\n  \n  try {\n    const updatedEvent = await apiUpdateEventById(eventId, finalData);\n    if (!updatedEvent) {\n      return { message: '更新活动失败，活动未找到或没有更改。', errors: { eventId: ['活动未找到或没有进行任何更改。'] }, success: false };\n    }\n    redirect(`/events/${eventId}`);\n  } catch (error: any) {\n     if (error && typeof error === 'object' && 'digest' in error && error.digest?.startsWith('NEXT_REDIRECT')) {\n      throw error;\n    }\n    console.error(\"Update Event Action - Server Error:\", error);\n    return { message: `更新活动时发生意外的服务器错误: ${error.message}`, errors: { form: [`更新活动时发生意外的服务器错误: ${error.message}`] }, success: false };\n  }\n}\n\n\nexport async function deleteEventAction(eventId: string, adminPassword: string): Promise<{ success: boolean, message: string }> {\n  const user = await getSessionUser();\n  if (!user) {\n    return { success: false, message: '需要认证才能删除活动。请先登录。' };\n  }\n  if (user.op !== 1) { // Only full admin can delete\n    return { success: false, message: '您没有删除活动的权限。' };\n  }\n  if (!user.password || user.password !== adminPassword) {\n    return { success: false, message: '您的账户密码不正确，无法删除活动。' };\n  }\n\n  try {\n    const result = await apiDeleteEventById(eventId); \n    return result;\n  } catch (error) {\n    console.error(\"删除活动错误:\", error);\n    return { success: false, message: '在服务器上删除活动失败。请稍后重试。' };\n  }\n}\n\n\nexport async function joinEventAction(eventId: string, cdKeyInput: string) {\n  const user = await getSessionUser();\n  if (!user) {\n    return { success: false, message: '您必须登录才能加入活动。' };\n  }\n  if (user.ban === 1) {\n    return { success: false, message: '您的账户已被封禁，无法加入活动。' };\n  }\n  try {\n    const result = await apiJoinEvent(user.id, eventId, cdKeyInput); \n    return result;\n  } catch (error) {\n    console.error(\"加入活动错误:\", error);\n    return { success: false, message: '加入活动时发生服务器错误。' };\n  }\n}\n\nexport async function joinEventUsingCdKeyOnlyAction(cdKey: string): Promise<{ success: boolean, message: string, event?: Event }> {\n  const user = await getSessionUser();\n  if (!user) {\n    return { success: false, message: '您必须登录才能加入活动。' };\n  }\n   if (user.ban === 1) {\n    return { success: false, message: '您的账户已被封禁，无法加入活动。' };\n  }\n\n  if (!cdKey || cdKey.trim() === '') {\n    return { success: false, message: '请输入有效的活动代码。' };\n  }\n\n  const eventToJoin = await getEventByCdKey(cdKey); \n  if (!eventToJoin) {\n    return { success: false, message: '具有此活动代码的活动未找到。' };\n  }\n  if (eventToJoin.timeMode === 'long-term') {\n    // For long-term events, joining might be automatic or not require a CD-Key.\n    // This specific action is for CD-Key based joining. If long-term events don't use CD-Keys for joining,\n    // then this action might not be appropriate for them, or cdKey would be the auto-generated one.\n    // For now, we'll assume if a cdKey matches a long-term event, it's a valid way to \"join\" or acknowledge it.\n  }\n\n  try {\n    // Pass eventToJoin.cdKey as the \"expected\" cdKey, even if cdKeyInput was used to find it.\n    const result = await apiJoinEvent(user.id, eventToJoin.id, eventToJoin.cdKey); \n    return result;\n  } catch (error) {\n    console.error(\"使用活动代码加入活动错误:\", error);\n    return { success: false, message: '使用活动代码加入活动时发生服务器错误。' };\n  }\n}\n\n\nexport async function leaveEventAction(eventId: string) {\n  const user = await getSessionUser();\n  if (!user) {\n    return { success: false, message: '您必须登录才能离开活动。' };\n  }\n  try {\n    const result = await apiLeaveEvent(user.id, eventId); \n    return result;\n  } catch (error) {\n    console.error(\"离开活动错误:\", error);\n    return { success: false, message: '离开活动时发生服务器错误。' };\n  }\n}\n\nexport async function checkInAction(eventId: string) {\n  const user = await getSessionUser();\n  if (!user) {\n    return { success: false, message: '您必须登录才能签到。' };\n  }\n  if (user.ban === 1) {\n    return { success: false, message: '您的账户已被封禁，无法签到。' };\n  }\n  try {\n    const result = await apiCheckInUser(user.id, eventId); \n    return result;\n  } catch (error) {\n    console.error(\"签到错误:\", error);\n    return { success: false, message: '签到过程中发生服务器错误。' };\n  }\n}\n\nexport async function getEventDetailsAction(eventId: string): Promise<Event | null> {\n  try {\n    const event = await getEventById(eventId); \n    return event || null;\n  } catch (error) {\n    console.error(\"获取活动详情错误 (action):\", error);\n    return null;\n  }\n}\n\nexport async function getEventsAction(): Promise<Event[]> {\n  try {\n    return await apiGetEvents(); \n  } catch (error) {\n    console.error(\"获取所有活动失败 (action):\", error);\n    return [];\n  }\n}\n\nexport async function getUserProfile(userId: string): Promise<{ user: User; joinedEvents: Event[] } | null> {\n  const user = await getUserById(userId);\n  if (!user) {\n    console.warn(`用户个人资料未找到: ${userId}`);\n    return null;\n  }\n  const joinedEvents = await getEventsForUser(userId);\n  return { user: {...user}, joinedEvents: joinedEvents.map(e => ({...e})) };\n}\n\nexport async function getAnnouncementsAction(): Promise<Announcement[]> {\n  try {\n    return await apiGetAnnouncements(); \n  } catch (error) {\n    console.error(\"获取公告失败 (action):\", error);\n    return [];\n  }\n}\n\n// --- User Management Actions (Admin/Co-Admin) ---\nexport async function getUsersAction(): Promise<User[]> {\n  const currentUser = await getSessionUser();\n  if (!currentUser || (currentUser.op !== 1 && currentUser.op !== 2)) {\n    console.warn(\"非授权用户尝试获取用户列表。\");\n    return [];\n  }\n  return apiGetUsers();\n}\n\nconst AdminAddUserBaseSchema = z.object({\n  minecraftUsername: MinecraftUsernameSchema,\n  avatarUrl: z.string().url(\"无效的头像链接。\").optional().or(z.literal('')),\n  password: PasswordSchema,\n  confirmPassword: PasswordSchema,\n  qqNumber: QQNumberSchema,\n  ban: z.preprocess(val => val === 'on' || val === true, z.boolean().default(false)),\n  adminConfirmPassword: z.string().min(1, \"需要您的密码来确认此操作。\")\n}).refine(data => data.password === data.confirmPassword, {\n  message: \"两次输入的密码不匹配。\",\n  path: [\"confirmPassword\"],\n});\n\nconst AdminAddUserByAdminSchema = AdminAddUserBaseSchema.extend({\n  op: z.enum(['0', '1', '2']).transform(Number),\n});\nconst AdminAddUserByCoAdminSchema = AdminAddUserBaseSchema.extend({\n  op: z.literal('0').transform(Number), // Co-admins can only create op 0 users\n});\n\n\nexport async function adminAddUserAction(prevState: AdminAddUserFormState, formData: FormData): Promise<AdminAddUserFormState> {\n  const performingUser = await getSessionUser();\n  if (!performingUser || (performingUser.op !== 1 && performingUser.op !== 2)) {\n    return { message: \"您没有权限执行此操作。\", success: false, errors: { form: [\"权限不足。\"] } };\n  }\n\n  const rawFormData = Object.fromEntries(formData.entries());\n   if (rawFormData.ban === 'on') rawFormData.ban = true; else rawFormData.ban = false;\n\n  const schemaToUse = performingUser.op === 1 ? AdminAddUserByAdminSchema : AdminAddUserByCoAdminSchema;\n  const validatedFields = schemaToUse.safeParse(rawFormData);\n\n  if (!validatedFields.success) {\n    return {\n      message: '输入无效。请检查您填写的信息。',\n      errors: validatedFields.error.flatten().fieldErrors as AdminAddUserFormState['errors'],\n      success: false,\n    };\n  }\n\n  const { minecraftUsername, avatarUrl, op, password, adminConfirmPassword, qqNumber, ban } = validatedFields.data;\n\n  if (performingUser.password !== adminConfirmPassword) {\n      return { message: '您的账户密码不正确，无法授权此操作。', errors: { adminConfirmPassword: ['管理员密码不正确。'] }, success: false };\n  }\n  \n  const isNameMCValid = await checkNameMC(minecraftUsername);\n  if (!isNameMCValid) {\n    return { message: '此 Minecraft 用户名在 NameMC 上无效或无法验证。', errors: { minecraftUsername: ['此 Minecraft 用户名在 NameMC 上无效或无法验证。'] }, success: false };\n  }\n\n  const existingUser = await getUserByUsername(minecraftUsername);\n  if (existingUser) {\n    return { message: '此 Minecraft 用户名已被注册。', errors: { minecraftUsername: ['此 Minecraft 用户名已被注册。'] }, success: false };\n  }\n\n  if (qqNumber && qqNumber.trim() !== '') {\n    const existingUserByQQ = await getUserByQQNumber(qqNumber);\n    if (existingUserByQQ) {\n      return { message: '此 QQ 号码已被其他用户绑定。', errors: { qqNumber: ['此 QQ 号码已被其他用户绑定。'] }, success: false };\n    }\n  }\n\n  try {\n    await apiCreateUser({\n      id: minecraftUsername,\n      username: minecraftUsername,\n      avatarUrl: avatarUrl || `https://placehold.co/100x100.png?text=${minecraftUsername.substring(0,2).toUpperCase()}`,\n      op: op, // This will be 0 if co-admin, or as specified if admin\n      password: password,\n      qqNumber: qqNumber || undefined,\n      ban: ban ? 1 : 0,\n    });\n    return { message: `用户 ${minecraftUsername} 已成功创建。`, success: true };\n  } catch (error: any) {\n    console.error(\"Admin Add User Action - Server Error:\", error);\n    return { message: `创建用户时发生服务器内部错误: ${error.message}`, success: false, errors: { form: [`创建用户时发生服务器内部错误: ${error.message}`] } };\n  }\n}\n\n\nconst AdminUpdateUserBaseSchema = z.object({\n  userIdToUpdate: z.string().min(1, \"用户ID是必需的。\"),\n  minecraftUsername: MinecraftUsernameSchema,\n  avatarUrl: z.string().url(\"无效的头像链接。\").optional().or(z.literal('')),\n  newPassword: PasswordSchema.optional().or(z.literal('')),\n  confirmNewPassword: PasswordSchema.optional().or(z.literal('')),\n  qqNumber: QQNumberSchema,\n  ban: z.preprocess(val => val === 'on' || val === true, z.boolean().default(false)),\n  adminConfirmPassword: z.string().min(1, \"需要您的密码来确认更改。\") \n}).refine(data => {\n  if (data.newPassword && data.newPassword !== data.confirmNewPassword) {\n    return false;\n  }\n  return true;\n}, {\n  message: \"两次输入的新密码不匹配。\",\n  path: [\"confirmNewPassword\"],\n});\n\nconst AdminUpdateUserByAdminSchema = AdminUpdateUserBaseSchema.extend({\n  op: z.enum(['0', '1', '2']).transform(Number),\n});\nconst AdminUpdateUserByCoAdminSchema = AdminUpdateUserBaseSchema.extend({\n  // Co-admin cannot change op, so it's not in their update schema for submission\n  // It will be fetched from existing user data if needed for other logic.\n});\n\n\nexport async function adminUpdateUserAction(prevState: AdminUpdateUserFormState, formData: FormData): Promise<AdminUpdateUserFormState> {\n try {\n  const performingUser = await getSessionUser();\n  if (!performingUser || (performingUser.op !== 1 && performingUser.op !== 2)) {\n    return { message: \"您没有权限执行此操作。\", success: false, errors: { form: [\"权限不足。\"] } };\n  }\n\n  const rawFormData = Object.fromEntries(formData.entries());\n  if (rawFormData.ban === 'on') rawFormData.ban = true; else rawFormData.ban = false;\n  \n  // Co-admins cannot change 'op', so we parse differently or handle 'op' post-validation\n  const baseValidatedFields = AdminUpdateUserBaseSchema.safeParse(rawFormData);\n  if (!baseValidatedFields.success) {\n    return {\n      message: '输入无效。请检查您填写的信息。',\n      errors: baseValidatedFields.error.flatten().fieldErrors as AdminUpdateUserFormState['errors'],\n      success: false,\n    };\n  }\n\n  const { userIdToUpdate, minecraftUsername, avatarUrl, newPassword, adminConfirmPassword, qqNumber, ban } = baseValidatedFields.data;\n  let opToSet: number | undefined = undefined;\n\n  if (performingUser.op === 1) { // Admin can set op\n    const opParseResult = z.enum(['0', '1', '2']).transform(Number).safeParse(rawFormData.op);\n    if (!opParseResult.success) {\n      return { message: \"无效的权限级别。\", success: false, errors: { op: [\"无效的权限级别。\"]}};\n    }\n    opToSet = opParseResult.data;\n  }\n  // If co-admin, opToSet remains undefined, and we'll skip updating it.\n\n  if (performingUser.password !== adminConfirmPassword) {\n      return { message: '您的账户密码不正确，无法授权此更改。', errors: { adminConfirmPassword: ['管理员密码不正确。'] }, success: false };\n  }\n\n  const userToUpdate = await getUserById(userIdToUpdate);\n  if (!userToUpdate) {\n    return { message: '要更新的用户未找到。', errors: { userIdToUpdate: ['用户未找到。'] }, success: false };\n  }\n\n  if (performingUser.op === 2 && userToUpdate.op === 1) { // Co-admin trying to edit Admin\n    return { message: \"协管员无权编辑管理员账户。\", success: false, errors: {form: [\"协管员无权编辑管理员账户。\"]}};\n  }\n  \n  if (minecraftUsername.toLowerCase() !== userToUpdate.username.toLowerCase()) {\n    const existingUserWithNewName = await getUserByUsername(minecraftUsername);\n    if (existingUserWithNewName && existingUserWithNewName.id !== userIdToUpdate) {\n      return { message: '此 Minecraft 用户名已被其他用户注册。', errors: { minecraftUsername: ['此 Minecraft 用户名已被其他用户注册。'] }, success: false };\n    }\n    const isNameMCValid = await checkNameMC(minecraftUsername);\n    if (!isNameMCValid) {\n      return { message: '新的 Minecraft 用户名在 NameMC 上无效或无法验证。', errors: { minecraftUsername: ['新的 Minecraft 用户名在 NameMC 上无效或无法验证。'] }, success: false };\n    }\n  }\n\n  if (qqNumber && qqNumber.trim() !== '' && qqNumber !== userToUpdate.qqNumber) {\n      const existingUserByQQ = await getUserByQQNumber(qqNumber);\n      if (existingUserByQQ && existingUserByQQ.id !== userIdToUpdate) {\n          return { message: '此 QQ 号码已被其他用户绑定。', errors: { qqNumber: ['此 QQ 号码已被其他用户绑定。'] }, success: false };\n      }\n  }\n  \n  const updateData: Partial<User> = {\n    username: minecraftUsername,\n    avatarUrl: avatarUrl || userToUpdate.avatarUrl,\n    qqNumber: qqNumber || null, // Store null if empty string\n    ban: ban ? 1 : 0,\n  };\n\n  if (newPassword) {\n    updateData.password = newPassword; \n  }\n  if (performingUser.op === 1 && opToSet !== undefined) { // Only admin can change op\n    updateData.op = opToSet;\n  }\n\n\n  await apiUpdateUserById(userIdToUpdate, updateData);\n\n  return { message: `用户 ${minecraftUsername} (ID: ${userIdToUpdate}) 已成功更新。`, success: true };\n\n} catch (error: any) {\n  console.error(\"Admin Update User Action - Server Error:\", error);\n  const errorMessage = error instanceof Error ? error.message : '更新用户时发生服务器内部错误。';\n  return { message: errorMessage, success: false, errors: { form: [errorMessage] } };\n}\n}\n\nexport async function adminDeleteUserAction(userIdToDelete: string, adminConfirmPassword: string): Promise<{ success: boolean; message: string }> {\n  const performingUser = await getSessionUser();\n  if (!performingUser || (performingUser.op !== 1 && performingUser.op !== 2)) {\n    return { success: false, message: \"您没有权限执行此操作。\" };\n  }\n  \n  const userToDelete = await getUserById(userIdToDelete);\n  if (!userToDelete) {\n    return { success: false, message: \"要删除的用户未找到。\" };\n  }\n\n  if (performingUser.id === userIdToDelete) {\n    return { success: false, message: \"您不能删除自己的账户。\" };\n  }\n  \n  if (performingUser.op === 2 && userToDelete.op === 1) { // Co-admin cannot delete Admin\n     return { success: false, message: \"协管员无权删除管理员账户。\" };\n  }\n\n  if (performingUser.password !== adminConfirmPassword) {\n    return { success: false, message: \"您的账户密码不正确，无法授权删除操作。\" };\n  }\n\n  try {\n    const result = await apiDeleteUserById(userIdToDelete);\n    return result;\n  } catch (error) {\n    console.error(\"Admin Delete User Action - Server Error:\", error);\n    const errorMessage = error instanceof Error ? error.message : \"删除用户时发生服务器内部错误。\";\n    return { success: false, message: errorMessage };\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1982, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 2084, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/layout.tsx"],"sourcesContent":["\n// This layout is now simplified as RootLayout handles global Header, Sidebar, and Footer.\n// It can be a pass-through or removed if the (app) group is no longer needed for other reasons.\nexport default function AppLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return <>{children}</>;\n}\n"],"names":[],"mappings":"AACA,0FAA0F;AAC1F,gGAAgG;;;;;;AACjF,SAAS,UAAU,EAChC,QAAQ,EAGT;IACC,qBAAO;kBAAG;;AACZ","debugId":null}},
    {"offset": {"line": 2102, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/loading-link.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/loading-link.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/loading-link.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAmS,GAChU,iEACA","debugId":null}},
    {"offset": {"line": 2116, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/loading-link.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/loading-link.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/loading-link.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA+Q,GAC5S,6CACA","debugId":null}},
    {"offset": {"line": 2130, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 2140, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n"],"names":[],"mappings":";;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACxC,OAAO,CAAA,GAAA,2JAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,qIAAA,CAAA,OAAI,AAAD,EAAE;AACtB","debugId":null}},
    {"offset": {"line": 2156, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/card.tsx"],"sourcesContent":["import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n"],"names":[],"mappings":";;;;;;;;;AAAA;AAEA;;;;AAEA,MAAM,qBAAO,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG1B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,4DACA;QAED,GAAG,KAAK;;;;;;AAGb,KAAK,WAAW,GAAG;AAEnB,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG;AAEzB,MAAM,0BAAY,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAG/B,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EACV,sDACA;QAED,GAAG,KAAK;;;;;;AAGb,UAAU,WAAW,GAAG;AAExB,MAAM,gCAAkB,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGrC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,iCAAiC;QAC9C,GAAG,KAAK;;;;;;AAGb,gBAAgB,WAAW,GAAG;AAE9B,MAAM,4BAAc,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGjC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QAAI,KAAK;QAAK,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,YAAY;QAAa,GAAG,KAAK;;;;;;AAEhE,YAAY,WAAW,GAAG;AAE1B,MAAM,2BAAa,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAGhC,CAAC,EAAE,SAAS,EAAE,GAAG,OAAO,EAAE,oBAC1B,8OAAC;QACC,KAAK;QACL,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,8BAA8B;QAC3C,GAAG,KAAK;;;;;;AAGb,WAAW,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 2237, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/button.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AAEA;;;;;;AAEA,MAAM,iBAAiB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACvB,4VACA;IACE,UAAU;QACR,SAAS;YACP,SAAS;YACT,aACE;YACF,SACE;YACF,WACE;YACF,OAAO;YACP,MAAM;QACR;QACA,MAAM;YACJ,SAAS;YACT,IAAI;YACJ,IAAI;YACJ,MAAM;QACR;IACF;IACA,iBAAiB;QACf,SAAS;QACT,MAAM;IACR;AACF;AASF,MAAM,uBAAS,CAAA,GAAA,qMAAA,CAAA,aAAgB,AAAD,EAC5B,CAAC,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,UAAU,KAAK,EAAE,GAAG,OAAO,EAAE;IACxD,MAAM,OAAO,UAAU,gKAAA,CAAA,OAAI,GAAG;IAC9B,qBACE,8OAAC;QACC,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,eAAe;YAAE;YAAS;YAAM;QAAU;QACxD,KAAK;QACJ,GAAG,KAAK;;;;;;AAGf;AAEF,OAAO,WAAW,GAAG","debugId":null}},
    {"offset": {"line": 2297, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/badge.tsx"],"sourcesContent":["import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n"],"names":[],"mappings":";;;;;AACA;AAEA;;;;AAEA,MAAM,gBAAgB,CAAA,GAAA,gKAAA,CAAA,MAAG,AAAD,EACtB,0KACA;IACE,UAAU;QACR,SAAS;YACP,SACE;YACF,WACE;YACF,aACE;YACF,SAAS;QACX;IACF;IACA,iBAAiB;QACf,SAAS;IACX;AACF;AAOF,SAAS,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,GAAG,OAAmB;IACzD,qBACE,8OAAC;QAAI,WAAW,CAAA,GAAA,mHAAA,CAAA,KAAE,AAAD,EAAE,cAAc;YAAE;QAAQ,IAAI;QAAa,GAAG,KAAK;;;;;;AAExE","debugId":null}},
    {"offset": {"line": 2339, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/avatar.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport const Avatar = registerClientReference(\n    function() { throw new Error(\"Attempted to call Avatar() from the server but Avatar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/avatar.tsx <module evaluation>\",\n    \"Avatar\",\n);\nexport const AvatarFallback = registerClientReference(\n    function() { throw new Error(\"Attempted to call AvatarFallback() from the server but AvatarFallback is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/avatar.tsx <module evaluation>\",\n    \"AvatarFallback\",\n);\nexport const AvatarImage = registerClientReference(\n    function() { throw new Error(\"Attempted to call AvatarImage() from the server but AvatarImage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/avatar.tsx <module evaluation>\",\n    \"AvatarImage\",\n);\n"],"names":[],"mappings":";;;;;AAAA;;AACO,MAAM,SAAS,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACxC;IAAa,MAAM,IAAI,MAAM;AAA4N,GACzP,8DACA;AAEG,MAAM,iBAAiB,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EAChD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,8DACA;AAEG,MAAM,cAAc,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EAC7C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,8DACA","debugId":null}},
    {"offset": {"line": 2361, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/ui/avatar.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server.edge\";\nexport const Avatar = registerClientReference(\n    function() { throw new Error(\"Attempted to call Avatar() from the server but Avatar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/avatar.tsx\",\n    \"Avatar\",\n);\nexport const AvatarFallback = registerClientReference(\n    function() { throw new Error(\"Attempted to call AvatarFallback() from the server but AvatarFallback is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/avatar.tsx\",\n    \"AvatarFallback\",\n);\nexport const AvatarImage = registerClientReference(\n    function() { throw new Error(\"Attempted to call AvatarImage() from the server but AvatarImage is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ui/avatar.tsx\",\n    \"AvatarImage\",\n);\n"],"names":[],"mappings":";;;;;AAAA;;AACO,MAAM,SAAS,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EACxC;IAAa,MAAM,IAAI,MAAM;AAA4N,GACzP,0CACA;AAEG,MAAM,iBAAiB,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EAChD;IAAa,MAAM,IAAI,MAAM;AAA4O,GACzQ,0CACA;AAEG,MAAM,cAAc,CAAA,GAAA,qPAAA,CAAA,0BAAuB,AAAD,EAC7C;IAAa,MAAM,IAAI,MAAM;AAAsO,GACnQ,0CACA","debugId":null}},
    {"offset": {"line": 2383, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 2393, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/user-avatar.tsx"],"sourcesContent":["\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport type { User } from \"@/lib/types\";\n\ninterface UserAvatarProps {\n  user: Pick<User, 'username' | 'avatarUrl'>;\n  className?: string;\n}\n\nexport default function UserAvatar({ user, className }: UserAvatarProps) {\n  const fallbackText = user.username ? user.username.substring(0, 2).toUpperCase() : \"??\";\n  // Default to a generic placeholder if avatarUrl is not provided\n  const imageSrc = user.avatarUrl || `https://placehold.co/40x40.png`;\n  // The data-ai-hint can guide image selection if a service uses it later\n  const aiHint = user.username ? `minecraft ${user.username}` : \"minecraft character\";\n\n\n  return (\n    <Avatar className={className}>\n      <AvatarImage src={imageSrc} alt={user.username || '用户头像'} data-ai-hint={aiHint} />\n      <AvatarFallback>{fallbackText}</AvatarFallback>\n    </Avatar>\n  );\n}\n"],"names":[],"mappings":";;;;AACA;;;AAQe,SAAS,WAAW,EAAE,IAAI,EAAE,SAAS,EAAmB;IACrE,MAAM,eAAe,KAAK,QAAQ,GAAG,KAAK,QAAQ,CAAC,SAAS,CAAC,GAAG,GAAG,WAAW,KAAK;IACnF,gEAAgE;IAChE,MAAM,WAAW,KAAK,SAAS,IAAI,CAAC,8BAA8B,CAAC;IACnE,wEAAwE;IACxE,MAAM,SAAS,KAAK,QAAQ,GAAG,CAAC,UAAU,EAAE,KAAK,QAAQ,EAAE,GAAG;IAG9D,qBACE,8OAAC,kIAAA,CAAA,SAAM;QAAC,WAAW;;0BACjB,8OAAC,kIAAA,CAAA,cAAW;gBAAC,KAAK;gBAAU,KAAK,KAAK,QAAQ,IAAI;gBAAQ,gBAAc;;;;;;0BACxE,8OAAC,kIAAA,CAAA,iBAAc;0BAAE;;;;;;;;;;;;AAGvB","debugId":null}},
    {"offset": {"line": 2438, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/lib/event-utils.ts"],"sourcesContent":["\nimport { isPast, isFuture, isEqual, parseISO, startOfDay, endOfDay, isWithinInterval } from 'date-fns';\nimport type { Event, EventStatus } from './types';\n\nexport function getEventStatus(event: Pick<Event, 'date' | 'endDate' | 'timeMode'>): EventStatus {\n  const now = new Date();\n  const startDate = parseISO(event.date);\n\n  if (event.timeMode === 'long-term') {\n    if (isFuture(startDate)) {\n      return 'upcoming';\n    }\n    // Long-term events, once started, are considered 'current' indefinitely by this logic.\n    // They don't have an 'endDate' that automatically makes them 'past'.\n    return 'current';\n  }\n\n  // Specified time mode\n  if (isFuture(startDate)) {\n    return 'upcoming';\n  }\n\n  if (event.endDate) {\n    const endDate = parseISO(event.endDate);\n    if (isAfter(now, endDate)) { // Check if current time is after the end date\n      return 'past';\n    }\n    // If current time is between start and end date (inclusive of start, exclusive of end by default for isWithinInterval)\n    // We need to check if 'now' is on or after startDate AND on or before endDate\n    if (isWithinInterval(now, { start: startDate, end: endDate }) || isEqual(now, startDate) || isEqual(now, endDate)) {\n        return 'current';\n    }\n    // If now is before startDate but after an end date (which shouldn't happen if dates are logical), treat as upcoming.\n    // This case is mostly covered by the isFuture(startDate) above.\n  } else {\n    // No end date specified, event is 'current' on its start day, 'past' afterwards.\n    if (isEqual(startOfDay(now), startOfDay(startDate))) {\n      return 'current';\n    }\n    if (isAfter(startOfDay(now), startOfDay(startDate))) {\n      return 'past';\n    }\n  }\n  // Default or fallback, should ideally be covered by above.\n  // If it's not future, and not past (or current for specified with end date), it's current.\n  // This covers the case where endDate is null and it's the start day.\n  if (isEqual(startOfDay(now), startOfDay(startDate))) return 'current';\n  \n  // If it's not upcoming and no clear past/current based on endDate, assume past if after start day.\n  if(isAfter(startOfDay(now), startOfDay(startDate)) && !event.endDate) return 'past';\n\n  return 'upcoming'; // Fallback, though less likely to be hit with proper date logic.\n}\n\nfunction isAfter(date1: Date, date2: Date): boolean {\n    return date1.getTime() > date2.getTime();\n}\n"],"names":[],"mappings":";;;AACA;AAAA;AAAA;AAAA;AAAA;;AAGO,SAAS,eAAe,KAAmD;IAChF,MAAM,MAAM,IAAI;IAChB,MAAM,YAAY,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,MAAM,IAAI;IAErC,IAAI,MAAM,QAAQ,KAAK,aAAa;QAClC,IAAI,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,YAAY;YACvB,OAAO;QACT;QACA,uFAAuF;QACvF,qEAAqE;QACrE,OAAO;IACT;IAEA,sBAAsB;IACtB,IAAI,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,YAAY;QACvB,OAAO;IACT;IAEA,IAAI,MAAM,OAAO,EAAE;QACjB,MAAM,UAAU,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,MAAM,OAAO;QACtC,IAAI,QAAQ,KAAK,UAAU;YACzB,OAAO;QACT;QACA,uHAAuH;QACvH,8EAA8E;QAC9E,IAAI,CAAA,GAAA,gJAAA,CAAA,mBAAgB,AAAD,EAAE,KAAK;YAAE,OAAO;YAAW,KAAK;QAAQ,MAAM,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,KAAK,cAAc,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,KAAK,UAAU;YAC/G,OAAO;QACX;IACA,qHAAqH;IACrH,gEAAgE;IAClE,OAAO;QACL,iFAAiF;QACjF,IAAI,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,MAAM,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,aAAa;YACnD,OAAO;QACT;QACA,IAAI,QAAQ,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,MAAM,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,aAAa;YACnD,OAAO;QACT;IACF;IACA,2DAA2D;IAC3D,2FAA2F;IAC3F,qEAAqE;IACrE,IAAI,CAAA,GAAA,uIAAA,CAAA,UAAO,AAAD,EAAE,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,MAAM,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,aAAa,OAAO;IAE5D,mGAAmG;IACnG,IAAG,QAAQ,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,MAAM,CAAA,GAAA,0IAAA,CAAA,aAAU,AAAD,EAAE,eAAe,CAAC,MAAM,OAAO,EAAE,OAAO;IAE7E,OAAO,YAAY,iEAAiE;AACtF;AAEA,SAAS,QAAQ,KAAW,EAAE,KAAW;IACrC,OAAO,MAAM,OAAO,KAAK,MAAM,OAAO;AAC1C","debugId":null}},
    {"offset": {"line": 2503, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/components/event-card.tsx"],"sourcesContent":["\nimport LoadingLink from '@/components/loading-link'; \nimport Image from 'next/image';\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle, CardDescription } from '@/components/ui/card';\nimport { Button } from '@/components/ui/button';\nimport { Badge } from '@/components/ui/badge';\nimport UserAvatar from '@/components/user-avatar';\nimport type { Event, EventStatus } from '@/lib/types';\nimport { CalendarDays, Users, KeyRound, ArrowRight } from 'lucide-react';\nimport { format, parseISO } from 'date-fns';\nimport { zhCN } from 'date-fns/locale';\nimport { getEventStatus } from '@/lib/event-utils';\n\ninterface EventCardProps {\n  event: Event;\n}\n\nexport default function EventCard({ event }: EventCardProps) {\n  const eventStatus = getEventStatus(event.date);\n  const formattedDate = format(parseISO(event.date), 'MM月d日 HH:mm', { locale: zhCN });\n\n  const statusTextMap: Record<EventStatus, string> = {\n    upcoming: '即将开始',\n    current: '进行中',\n    past: '已结束',\n  };\n\n  const statusColors: Record<EventStatus, string> = {\n    upcoming: 'bg-blue-500 hover:bg-blue-600',\n    current: 'bg-green-500 hover:bg-green-600',\n    past: 'bg-gray-500 hover:bg-gray-500',\n  };\n\n  const getImageHint = (eventName: string) => {\n    if (eventName.toLowerCase().includes('survival') || eventName.toLowerCase().includes('生存')) return \"minecraft survival\";\n    if (eventName.toLowerCase().includes('build') || eventName.toLowerCase().includes('建筑')) return \"minecraft build\";\n    if (eventName.toLowerCase().includes('parkour') || eventName.toLowerCase().includes('跑酷')) return \"minecraft parkour\";\n    if (eventName.toLowerCase().includes('redstone') || eventName.toLowerCase().includes('红石')) return \"minecraft redstone\";\n    return \"minecraft game\";\n  }\n\n  const imageUrl = event.imageUrl || `https://placehold.co/400x200.png`;\n  const aiHint = getImageHint(event.name);\n\n  return (\n    <Card className=\"flex flex-col overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300 rounded-lg\">\n      <div className=\"relative w-full h-48\">\n        <Image\n          src={imageUrl}\n          alt={event.name}\n          layout=\"fill\"\n          objectFit=\"cover\"\n          data-ai-hint={aiHint}\n        />\n        <Badge\n          className={`absolute top-2 right-2 text-white px-2 py-1 text-xs font-semibold rounded ${statusColors[eventStatus]}`}\n        >\n          {statusTextMap[eventStatus]}\n        </Badge>\n      </div>\n      <CardHeader>\n        <CardTitle className=\"text-xl font-bold\">{event.name}</CardTitle>\n        <CardDescription className=\"flex items-center text-sm text-muted-foreground pt-1\">\n          <CalendarDays className=\"mr-2 h-4 w-4\" /> {formattedDate}\n        </CardDescription>\n      </CardHeader>\n      <CardContent className=\"flex-grow\">\n        <p className=\"text-sm text-muted-foreground line-clamp-3 mb-4\">\n          {event.description.split('\\n')[0].replace(/^[#\\\\s>*-]+/, '')}\n        </p>\n        <div className=\"flex items-center space-x-2 mb-2\">\n          <Users className=\"h-4 w-4 text-muted-foreground\" />\n          <span className=\"text-sm\">\n            {event.participants.length} / {event.participantLimit || '∞'} 参与者\n          </span>\n        </div>\n        <div className=\"flex items-center space-x-2 text-sm text-muted-foreground\">\n          <KeyRound className=\"h-4 w-4\" />\n          <span>活动代码: <Badge variant=\"secondary\">{event.cdKey}</Badge></span>\n        </div>\n        {event.participants.length > 0 && (\n          <div className=\"mt-4\">\n            <h4 className=\"text-xs font-semibold mb-1 text-muted-foreground\">部分参与者:</h4>\n            <div className=\"flex -space-x-2 overflow-hidden\">\n              {event.participants.slice(0, 5).map((p) => (\n                <UserAvatar key={p.id} user={p} className=\"h-6 w-6 border-2 border-card\" />\n              ))}\n              {event.participants.length > 5 && (\n                <div className=\"flex items-center justify-center h-6 w-6 rounded-full bg-muted text-muted-foreground text-xs border-2 border-card\">\n                  +{event.participants.length - 5}\n                </div>\n              )}\n            </div>\n          </div>\n        )}\n      </CardContent>\n      <CardFooter>\n        <Button asChild className=\"w-full\" variant=\"default\">\n          <LoadingLink href={`/events/${event.id}`}>\n            查看活动 <ArrowRight className=\"ml-2 h-4 w-4\" />\n          </LoadingLink>\n        </Button>\n      </CardFooter>\n    </Card>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2790, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/%28app%29/page.tsx"],"sourcesContent":["\nimport EventCard from '@/components/event-card';\nimport { getEvents } from '@/lib/data';\nimport type { Event } from '@/lib/types';\nimport { parseISO } from 'date-fns';\nimport { CalendarX } from 'lucide-react';\n\nexport const dynamic = 'force-dynamic';\n\nexport default async function HomePage() {\n  const allEvents = await getEvents();\n\n  // Sort events by date in descending order (newest first)\n  const sortedEvents = allEvents.sort((a, b) => {\n    return parseISO(b.date).getTime() - parseISO(a.date).getTime();\n  });\n\n  return (\n    <div className=\"container mx-auto px-4 py-8 space-y-8\">\n      <h1 className=\"text-3xl font-bold tracking-tight text-foreground\">所有活动</h1>\n\n      {sortedEvents.length === 0 ? (\n        <div className=\"flex flex-col items-center justify-center text-center py-12 min-h-[calc(100vh-22rem)]\">\n          <CalendarX className=\"h-16 w-16 text-muted-foreground/70 mb-6\" />\n          <h2 className=\"text-xl font-semibold text-muted-foreground mb-3\">暂无活动</h2>\n          <p className=\"text-muted-foreground max-w-md\">\n            当前没有任何《我的世界》活动。您可以稍后再回来查看，或者如果您是管理员，可以尝试创建一个新的活动！\n          </p>\n        </div>\n      ) : (\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-6\">\n          {sortedEvents.map(event => (\n            <EventCard key={event.id} event={event} />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AACA;AACA;AAEA;AACA;;;;;;AAEO,MAAM,UAAU;AAER,eAAe;IAC5B,MAAM,YAAY,MAAM,CAAA,GAAA,kHAAA,CAAA,YAAS,AAAD;IAEhC,yDAAyD;IACzD,MAAM,eAAe,UAAU,IAAI,CAAC,CAAC,GAAG;QACtC,OAAO,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,EAAE,IAAI,EAAE,OAAO,KAAK,CAAA,GAAA,wIAAA,CAAA,WAAQ,AAAD,EAAE,EAAE,IAAI,EAAE,OAAO;IAC9D;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAAoD;;;;;;YAEjE,aAAa,MAAM,KAAK,kBACvB,8OAAC;gBAAI,WAAU;;kCACb,8OAAC,gNAAA,CAAA,YAAS;wBAAC,WAAU;;;;;;kCACrB,8OAAC;wBAAG,WAAU;kCAAmD;;;;;;kCACjE,8OAAC;wBAAE,WAAU;kCAAiC;;;;;;;;;;;qCAKhD,8OAAC;gBAAI,WAAU;0BACZ,aAAa,GAAG,CAAC,CAAA,sBAChB,8OAAC,mIAAA,CAAA,UAAS;wBAAgB,OAAO;uBAAjB,MAAM,EAAE;;;;;;;;;;;;;;;;AAMpC","debugId":null}},
    {"offset": {"line": 2880, "column": 0}, "map": {"version":3,"sources":["file:///home/user/studio/src/app/page.tsx"],"sourcesContent":["\nimport AppLayout from './(app)/layout';\nimport ActualHomePageContent from './(app)/page';\n\n// This page ensures that the root path (\"/\") is rendered using the main AppLayout\n// and the HomePage content defined within the (app) route group.\n// It effectively delegates the rendering of the homepage to the (app) structure.\nexport default async function Page() {\n  return (\n    <AppLayout>\n      <ActualHomePageContent />\n    </AppLayout>\n  );\n}\n"],"names":[],"mappings":";;;;AACA;AACA;;;;AAKe,eAAe;IAC5B,qBACE,8OAAC,gIAAA,CAAA,UAAS;kBACR,cAAA,8OAAC,8HAAA,CAAA,UAAqB;;;;;;;;;;AAG5B","debugId":null}}]
}